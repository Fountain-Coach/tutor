name: Swift Tutorials CI

on:
  push:
    branches: [ main, master ]
  pull_request:
    branches: [ "**" ]

jobs:
  build-and-test:
    runs-on: macos-latest
    strategy:
      fail-fast: false
      matrix:
        tutorial:
          - 01-hello-fountainai
          - 02-basic-ui-teatro
          - 03-data-persistence-fountainstore
          - 04-multimedia-midi2
          - 05-ai-integration-openapi
          - 06-screenplay-editor-capstone
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Show Swift version
        run: swift --version

      - name: Build Tutor CLI
        run: |
          cd tools/tutor-cli
          swift build -c release

      - name: Setup tutorial scaffold
        working-directory: tutorials/${{ matrix.tutorial }}
        run: |
          chmod +x setup.sh
          ./setup.sh

      - name: Build
        run: tools/tutor-cli/.build/release/tutor build --dir tutorials/${{ matrix.tutorial }}

      - name: Test
        run: tools/tutor-cli/.build/release/tutor test --dir tutorials/${{ matrix.tutorial }}
