# Dependency Management Deep Dive (SwiftPM + FountainAI)

This guide explains how tutorial apps depend on the FountainAI monorepo using Swift Package Manager (SwiftPM), what each profile includes, and how resolution, pinning, and updates work.

## SwiftPM Basics
- Package: A project with `Package.swift` describing products (binaries) and targets (modules).
- Dependency: Another package added via `.package(url: ..., version/branch/revision)`.
- Product: A library or executable a target can depend on (e.g., `LLMGatewayAPI`).
- Resolution: SwiftPM fetches dependencies and builds only referenced targets and their transitives.

## How Tutorials Use FountainAI
- Local mode (`./setup.sh`): Generates a minimal app (no external deps) for fast loops and unit tests.
- Upstream mode (`./setup.sh --upstream`): Copies a scaffolded `main.swift` and generates a local `Package.swift` that points to the FountainAI monorepo.
- Profiles (`--profile <name>`): Select which client libraries your target depends on; SwiftPM builds only those and their transitives.

## Profiles â†’ Modules
- basic: no external modules.
- ai: `FountainAICore`, `FountainAIAdapters`, `LLMGatewayAPI`.
- persist: `PersistAPI`, `FountainStoreClient` (plus core/adapters).
- midi2: `MIDI2Models`, `MIDI2Core`, `SSEOverMIDI`, `FlexBridge`.
- capstone: union of ai + persist + midi2.
- full-client: `GatewayAPI`, `LLMGatewayAPI`, `PersistAPI`, `SemanticBrowserAPI` (plus core/adapters).

## Versioning & Pinning
- Default: `main` branch of FountainAI for rapid iteration.
- Stable builds: pin a tag or commit in `Package.swift`:
  - Tag: `.package(url: "...", from: "1.2.3")`
  - Commit: `.package(url: "...", revision: "<sha>")`
- `Package.resolved` is generated by SwiftPM; commit it to lock transitive versions.

## Build, Run, Test
- Build: `swift build` compiles your app and required modules.
- Run: `swift run` executes the app.
- Tests: `swift test` runs XCTest targets; all tutorials scaffold tests by default.
- Xcode: `xed .` opens the package; Xcode uses the same resolution.

## Updates & Caching
- Update FountainAI: `swift package update` (or bump the version in `Package.swift`).
- Cache: SwiftPM caches downloads/builds; only changed targets rebuild when you switch profiles.

## Troubleshooting
- Missing modules: ensure you used a profile that includes the needed products and re-run `./setup.sh --profile <name> --upstream`.
- Build fails on macOS: install Xcode CLT and accept the license; try `xcodebuild -runFirstLaunch`.
- Network issues: retry after connectivity restores; SwiftPM resumes from cache when possible.

## Rationale
- Profiles keep tutorial builds fast and focused while enabling deeper integration when needed.
- App-facing modules avoid server executables and plugins unless you explicitly opt in.

